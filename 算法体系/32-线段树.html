<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>线段树 | 冯手力-java学习之路</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.49d708b7.css" as="style"><link rel="preload" href="/assets/js/app.e07e71c0.js" as="script"><link rel="preload" href="/assets/js/2.141f6c6e.js" as="script"><link rel="preload" href="/assets/js/1.aeca74fc.js" as="script"><link rel="preload" href="/assets/js/37.7c920bbb.js" as="script"><link rel="prefetch" href="/assets/js/10.6454839f.js"><link rel="prefetch" href="/assets/js/100.368f23f1.js"><link rel="prefetch" href="/assets/js/101.00ce5f2d.js"><link rel="prefetch" href="/assets/js/102.2e33eadc.js"><link rel="prefetch" href="/assets/js/103.bf1f1898.js"><link rel="prefetch" href="/assets/js/104.ccf2615b.js"><link rel="prefetch" href="/assets/js/105.7795e6bd.js"><link rel="prefetch" href="/assets/js/106.f5778cf7.js"><link rel="prefetch" href="/assets/js/107.e33dd4e8.js"><link rel="prefetch" href="/assets/js/108.c9be7944.js"><link rel="prefetch" href="/assets/js/109.98fdbd95.js"><link rel="prefetch" href="/assets/js/11.94400a88.js"><link rel="prefetch" href="/assets/js/110.ed0bfbc1.js"><link rel="prefetch" href="/assets/js/111.42f3b1b5.js"><link rel="prefetch" href="/assets/js/112.8909570b.js"><link rel="prefetch" href="/assets/js/113.0e089493.js"><link rel="prefetch" href="/assets/js/114.f8b35cbe.js"><link rel="prefetch" href="/assets/js/115.7b6b19de.js"><link rel="prefetch" href="/assets/js/116.3011286b.js"><link rel="prefetch" href="/assets/js/12.e5c95389.js"><link rel="prefetch" href="/assets/js/13.a780f0b2.js"><link rel="prefetch" href="/assets/js/14.cd3eb341.js"><link rel="prefetch" href="/assets/js/15.7fa4ca08.js"><link rel="prefetch" href="/assets/js/16.b52e6f1a.js"><link rel="prefetch" href="/assets/js/17.51238ac2.js"><link rel="prefetch" href="/assets/js/18.b5c96836.js"><link rel="prefetch" href="/assets/js/19.4134f8c5.js"><link rel="prefetch" href="/assets/js/20.ff10fee9.js"><link rel="prefetch" href="/assets/js/21.f7a8e7c3.js"><link rel="prefetch" href="/assets/js/22.d2e28955.js"><link rel="prefetch" href="/assets/js/23.247fa163.js"><link rel="prefetch" href="/assets/js/24.77039758.js"><link rel="prefetch" href="/assets/js/25.a1f9a9fd.js"><link rel="prefetch" href="/assets/js/26.f1fd32d8.js"><link rel="prefetch" href="/assets/js/27.8bf12c1f.js"><link rel="prefetch" href="/assets/js/28.97916316.js"><link rel="prefetch" href="/assets/js/29.af2c7e24.js"><link rel="prefetch" href="/assets/js/3.c4628f1e.js"><link rel="prefetch" href="/assets/js/30.71765176.js"><link rel="prefetch" href="/assets/js/31.584c7c55.js"><link rel="prefetch" href="/assets/js/32.66246b1c.js"><link rel="prefetch" href="/assets/js/33.08bdfb2e.js"><link rel="prefetch" href="/assets/js/34.60328b36.js"><link rel="prefetch" href="/assets/js/35.4506e2a2.js"><link rel="prefetch" href="/assets/js/36.c40cc548.js"><link rel="prefetch" href="/assets/js/38.068254d9.js"><link rel="prefetch" href="/assets/js/39.85054a88.js"><link rel="prefetch" href="/assets/js/4.ecb21d45.js"><link rel="prefetch" href="/assets/js/40.aaa96beb.js"><link rel="prefetch" href="/assets/js/41.1188046b.js"><link rel="prefetch" href="/assets/js/42.4d9986c9.js"><link rel="prefetch" href="/assets/js/43.632aaf09.js"><link rel="prefetch" href="/assets/js/44.b8c1a2f5.js"><link rel="prefetch" href="/assets/js/45.48b59d6c.js"><link rel="prefetch" href="/assets/js/46.f9a60cf0.js"><link rel="prefetch" href="/assets/js/47.463cd8b0.js"><link rel="prefetch" href="/assets/js/48.b913d000.js"><link rel="prefetch" href="/assets/js/49.eb9c1742.js"><link rel="prefetch" href="/assets/js/5.25f3d3ba.js"><link rel="prefetch" href="/assets/js/50.7b685d42.js"><link rel="prefetch" href="/assets/js/51.4ee0ccd7.js"><link rel="prefetch" href="/assets/js/52.f7655265.js"><link rel="prefetch" href="/assets/js/53.7bbc0c38.js"><link rel="prefetch" href="/assets/js/54.e7dc87fd.js"><link rel="prefetch" href="/assets/js/55.ed709821.js"><link rel="prefetch" href="/assets/js/56.01471982.js"><link rel="prefetch" href="/assets/js/57.70b1afb9.js"><link rel="prefetch" href="/assets/js/58.d28eed0c.js"><link rel="prefetch" href="/assets/js/59.f40d0536.js"><link rel="prefetch" href="/assets/js/6.5e5fc68e.js"><link rel="prefetch" href="/assets/js/60.5c092d5a.js"><link rel="prefetch" href="/assets/js/61.ba6150f8.js"><link rel="prefetch" href="/assets/js/62.caf95c91.js"><link rel="prefetch" href="/assets/js/63.5b26e1fa.js"><link rel="prefetch" href="/assets/js/64.f65d29c9.js"><link rel="prefetch" href="/assets/js/65.4f304b26.js"><link rel="prefetch" href="/assets/js/66.581509ff.js"><link rel="prefetch" href="/assets/js/67.68726c69.js"><link rel="prefetch" href="/assets/js/68.8465c00a.js"><link rel="prefetch" href="/assets/js/69.3b6c5b0a.js"><link rel="prefetch" href="/assets/js/7.691ddf19.js"><link rel="prefetch" href="/assets/js/70.f2db4249.js"><link rel="prefetch" href="/assets/js/71.d8a1256c.js"><link rel="prefetch" href="/assets/js/72.18483dc5.js"><link rel="prefetch" href="/assets/js/73.c6b97da8.js"><link rel="prefetch" href="/assets/js/74.a81b6bcf.js"><link rel="prefetch" href="/assets/js/75.50dc2885.js"><link rel="prefetch" href="/assets/js/76.511d2618.js"><link rel="prefetch" href="/assets/js/77.d6e5c7ff.js"><link rel="prefetch" href="/assets/js/78.7d1698d4.js"><link rel="prefetch" href="/assets/js/79.c4fda0a9.js"><link rel="prefetch" href="/assets/js/80.462f8ba8.js"><link rel="prefetch" href="/assets/js/81.7048f958.js"><link rel="prefetch" href="/assets/js/82.ad8746ae.js"><link rel="prefetch" href="/assets/js/83.2704bf88.js"><link rel="prefetch" href="/assets/js/84.90e624fd.js"><link rel="prefetch" href="/assets/js/85.80bc7053.js"><link rel="prefetch" href="/assets/js/86.1fadcd7d.js"><link rel="prefetch" href="/assets/js/87.e637bd10.js"><link rel="prefetch" href="/assets/js/88.9d2b3994.js"><link rel="prefetch" href="/assets/js/89.4c9c9d14.js"><link rel="prefetch" href="/assets/js/90.74511a36.js"><link rel="prefetch" href="/assets/js/91.f5fb1c3a.js"><link rel="prefetch" href="/assets/js/92.bbd994da.js"><link rel="prefetch" href="/assets/js/93.e21f7b0e.js"><link rel="prefetch" href="/assets/js/94.d361b759.js"><link rel="prefetch" href="/assets/js/95.6116c3e2.js"><link rel="prefetch" href="/assets/js/96.0bf8845f.js"><link rel="prefetch" href="/assets/js/97.59c4cd83.js"><link rel="prefetch" href="/assets/js/98.2955f6a5.js"><link rel="prefetch" href="/assets/js/99.780089e6.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.778070dd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.49d708b7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">冯手力-java学习之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/操作/" class="nav-link">
  操作
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="经验" class="dropdown-title"><span class="title">经验</span> <span class="arrow down"></span></button> <button type="button" aria-label="经验" class="mobile-dropdown-title"><span class="title">经验</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/工作经验/" class="nav-link">
  工作经验
</a></li><li class="dropdown-item"><!----> <a href="/项目经验/" class="nav-link">
  项目经验
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术相关" class="dropdown-title"><span class="title">技术相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术相关" class="mobile-dropdown-title"><span class="title">技术相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          java技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/" class="nav-link">
  java
</a></li><li class="dropdown-subitem"><a href="https://github.com/hehonghui/mockito-doc-zh#0" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mockito
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/xiao__jia__jia/article/details/115252780" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mockito详解
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/数据库/" class="nav-link">
  数据库技术
</a></li></ul></div></div><div class="nav-item"><a href="/架构之路/" class="nav-link">
  架构之路
</a></div><div class="nav-item"><a href="/领域驱动设计/" class="nav-link">
  领域驱动设计
</a></div><div class="nav-item"><a href="/源码解析/" class="nav-link">
  源码解析
</a></div><div class="nav-item"><a href="/程序员英语/" class="nav-link">
  程序员英语
</a></div><div class="nav-item"><a href="/面试突击班/" class="nav-link">
  面试突击班
</a></div><div class="nav-item"><a href="/算法体系/" class="nav-link">
  算法体系
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="下拉目录测试" class="dropdown-title"><span class="title">下拉目录测试</span> <span class="arrow down"></span></button> <button type="button" aria-label="下拉目录测试" class="mobile-dropdown-title"><span class="title">下拉目录测试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/ts/" class="nav-link">
  具体.md文档
</a></li><li class="dropdown-item"><!----> <a href="/guide/vue/test03.html" class="nav-link">
  文件夹下Readme
</a></li><li class="dropdown-item"><!----> <a href="https://www.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  其他连接测试-百度链接
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/用友/" class="nav-link">
  用友
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/操作/" class="nav-link">
  操作
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="经验" class="dropdown-title"><span class="title">经验</span> <span class="arrow down"></span></button> <button type="button" aria-label="经验" class="mobile-dropdown-title"><span class="title">经验</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/工作经验/" class="nav-link">
  工作经验
</a></li><li class="dropdown-item"><!----> <a href="/项目经验/" class="nav-link">
  项目经验
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术相关" class="dropdown-title"><span class="title">技术相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术相关" class="mobile-dropdown-title"><span class="title">技术相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          java技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/" class="nav-link">
  java
</a></li><li class="dropdown-subitem"><a href="https://github.com/hehonghui/mockito-doc-zh#0" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mockito
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/xiao__jia__jia/article/details/115252780" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mockito详解
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/数据库/" class="nav-link">
  数据库技术
</a></li></ul></div></div><div class="nav-item"><a href="/架构之路/" class="nav-link">
  架构之路
</a></div><div class="nav-item"><a href="/领域驱动设计/" class="nav-link">
  领域驱动设计
</a></div><div class="nav-item"><a href="/源码解析/" class="nav-link">
  源码解析
</a></div><div class="nav-item"><a href="/程序员英语/" class="nav-link">
  程序员英语
</a></div><div class="nav-item"><a href="/面试突击班/" class="nav-link">
  面试突击班
</a></div><div class="nav-item"><a href="/算法体系/" class="nav-link">
  算法体系
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="下拉目录测试" class="dropdown-title"><span class="title">下拉目录测试</span> <span class="arrow down"></span></button> <button type="button" aria-label="下拉目录测试" class="mobile-dropdown-title"><span class="title">下拉目录测试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/ts/" class="nav-link">
  具体.md文档
</a></li><li class="dropdown-item"><!----> <a href="/guide/vue/test03.html" class="nav-link">
  文件夹下Readme
</a></li><li class="dropdown-item"><!----> <a href="https://www.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  其他连接测试-百度链接
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/用友/" class="nav-link">
  用友
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/%E7%AE%97%E6%B3%95%E4%BD%93%E7%B3%BB/" aria-current="page" class="sidebar-link">算法体系学习</a></li><li><a href="/算法体系/算法基础.html" class="sidebar-link">算法基础学习</a></li><li><a href="/算法体系/算法新手班.html" class="sidebar-link">算法新手班</a></li><li><a href="/算法体系/7~8-堆-被火车撞了都不能忘记的结构.html" class="sidebar-link">堆-被火车撞了都不能忘记的结构</a></li><li><a href="/算法体系/9-前缀树.html" class="sidebar-link">前缀树（prefix tree/trie）</a></li><li><a href="/算法体系/10-排序总结,链表相关题目.html" class="sidebar-link">10-排序总结,链表相关题目</a></li><li><a href="/算法体系/11~13-二叉树.html" class="sidebar-link">二叉树</a></li><li><a href="/算法体系/15~16-并查集-查连通区域神器.html" class="sidebar-link">并查集-查连通区域神器</a></li><li><a href="/算法体系/17-图.html" class="sidebar-link">图</a></li><li><a href="/算法体系/18~24-暴力递归到动态规划.html" class="sidebar-link">暴力递归到动态规划</a></li><li><a href="/算法体系/25-滑动窗口内最大值或最小值问题.html" class="sidebar-link">滑动窗口内最大值或最小值问题</a></li><li><a href="/算法体系/26-单调栈.html" class="sidebar-link">单调栈</a></li><li><a href="/算法体系/28-KMP算法.html" class="sidebar-link">KMP算法</a></li><li><a href="/算法体系/29-Manacher算法.html" class="sidebar-link">Manacher算法</a></li><li><a href="/算法体系/30-蓄水池算法.html" class="sidebar-link">蓄水池算法</a></li><li><a href="/算法体系/30-bfprt算法-topk.html" class="sidebar-link">bfprt算法</a></li><li><a href="/算法体系/31-Morris遍历.html" class="sidebar-link">Morris遍历</a></li><li><a href="/算法体系/32-线段树.html" class="active sidebar-link">线段树</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#用途" class="sidebar-link">用途</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#敏感度" class="sidebar-link">敏感度</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#本篇文章含金量" class="sidebar-link">本篇文章含金量</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#线段树实例一" class="sidebar-link">线段树实例一</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#下标默认规定" class="sidebar-link">下标默认规定</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#建树方式" class="sidebar-link">建树方式</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#懒更新" class="sidebar-link">懒更新</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#线段树代码" class="sidebar-link">线段树代码</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#落方块问题" class="sidebar-link">落方块问题</a></li><li class="sidebar-sub-header"><a href="/算法体系/32-线段树.html#刷房子问题" class="sidebar-link">刷房子问题.</a></li></ul></li><li><a href="/算法体系/大厂-21-树链刨分.html" class="sidebar-link">树链刨分</a></li><li><a href="/算法体系/33-IndexTree,AC自动机.html" class="sidebar-link">IndexTree,AC自动机</a></li><li><a href="/算法体系/34-与哈希函数有关的数据结构.html" class="sidebar-link">与哈希函数有关的数据结构</a></li><li><a href="/算法体系/35-资源限制类题目解题思路.html" class="sidebar-link">资源限制类题目解题思路</a></li><li><a href="/算法体系/41-数组三连问题.html" class="sidebar-link">数组三连问题.</a></li><li><a href="/算法体系/大厂刷题.html" class="sidebar-link">大厂刷题</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="线段树"><a href="#线段树" class="header-anchor">#</a> 线段树</h1> <h2 id="用途"><a href="#用途" class="header-anchor">#</a> 用途</h2> <ol><li><p>一种支持范围整体修改和范围整体查询的数据结构</p></li> <li><p>解决的问题范畴：<br>
大范围信息可以只由左、右两侧信息加工出，</p> <p>而不必遍历左右两个子范围的具体状况</p> <ol><li>例如:求最大值,累加和,==这种就可以==,因为左右都知道,我就是左右相加或者左右比max.</li> <li>而求出现最多的字符,==这种就不行==,比如,左侧是a是5次,右侧b是6次,但是可能左侧c有4次,右侧c有4次.实际我应该是c有8次,左右信息我没办法简单的加工出来.</li></ol></li></ol> <h2 id="敏感度"><a href="#敏感度" class="header-anchor">#</a> 敏感度</h2> <p>线段树相关问题的题,不缺乏敏感度,一般只要提到某个范围修改,然后要查询,就可以联想到线段树解题思路.</p> <h2 id="本篇文章含金量"><a href="#本篇文章含金量" class="header-anchor">#</a> 本篇文章含金量</h2> <p>网上的其他的帖子解决的问题,基本都是单个add+查询或者单个Update+查询,几乎没有add+update+查询的,add和update是非常容易冲突的.所以本篇文章,很有含金量.</p> <h2 id="线段树实例一"><a href="#线段树实例一" class="header-anchor">#</a> 线段树实例一</h2> <blockquote><p>给定一个数组arr，用户希望你实现如下三个方法<br>
1）void add(int L, int R, int V) :  让数组arr[L…R]上每个数都加上V<br>
2）void update(int L, int R, int V) :  让数组arr[L…R]上每个数都变成V<br>
3）int sum(int L, int R) :让返回arr[L…R]这个范围整体的累加和<br>
怎么让这三个方法，时间复杂度都是O(logN)</p></blockquote> <p>暴力方法,如果说,我让每次加法,或者更新,再查累加和,是不是每次都是O(N),就是很慢.</p> <p>如果我是logN的复杂度,那我太快了,2^64这种海量数据,也就是64次内搞定.</p> <h2 id="下标默认规定"><a href="#下标默认规定" class="header-anchor">#</a> 下标默认规定</h2> <p>线段树,默认数据下标从1开始,0位置,舍弃不用.</p> <h2 id="建树方式"><a href="#建树方式" class="header-anchor">#</a> 建树方式</h2> <p>就是二分,左右搞个几乎一半的方式,如果是偶数,平分即可, 如果是奇数,左右哪边都可以是多的,但是规则一致即可.</p> <p><img src="/assets/img/image-20240623232150881.35ae0285.png" alt="image-20240623232150881"></p> <p>任何一个节点,他的父:<code>i/2</code>,他的左孩子,<code>2*i</code>,他的右孩子<code>2*i+1</code>.</p> <p>注意,例如[3,3],他不是没有孩子,他有,只是左右孩子都是null.</p> <p>我们把这个树型结构,用一个数组表示,就是,如下图所示,注意,同样0位置舍弃不用.</p> <p><img src="/assets/img/image-20240623233037548.328169f1.png" alt="image-20240623233037548"></p> <p>==这个数组,最多,多大够用?==4N,足矣.上图为例,算上全部的null,也不可能超过4N.</p> <p>假设最省的情况,就是2^整数次个,最费情况,就是2^整数次+1个.底下只有1个,剩下都是null.</p> <p>假设,n=5,2^2+1个,最费的情况下,建立前面4个的是2N个,底下又干出一层,又是2N,所以最多4N搞定.</p> <h2 id="懒更新"><a href="#懒更新" class="header-anchor">#</a> 懒更新</h2> <p>懒更新的意思就是,我给一个范围进行修改,从顶向下发送&quot;&quot;任务&quot;&quot;,如果这个任务范围,完全覆盖了我某个树节点,我直接拦住,不再下发,然后用一个数组记下来.</p> <p><img src="/assets/img/image-20240623234422694.f33ea502.png" alt="image-20240623234422694"></p> <p>如果发现新任务来了,正好又覆盖了我的范围,看我有没有懒信息,2种处理方式,</p> <p>1.如果有,先下发一层.相当于把我之前懒得都清账了,然后我记录最新的懒信息.</p> <p>2.处理时候,发现又是完全覆盖,我不下发了,直接累加懒信息.</p> <h2 id="线段树代码"><a href="#线段树代码" class="header-anchor">#</a> 线段树代码</h2> <ol><li>看定义的属性,大概的含义,</li> <li>看构造方法,初始化数组长度等,</li> <li>看build,将原数组,二分,放到新的数组中,最大4N肯定够放了.</li> <li>看add方法,将某段任务,下发,如果整个某段被hold住了,懒数组懒住.否则,先清账,将我的懒信息下发,然后任务下发到左右,最后我汇总我左右的信息.</li> <li>看pushUp ,就是汇总我的左孩子和右孩子的信息,最大值或者累加和这种信息.</li> <li>看pushDown,就是当我hold不住任务时候,我需要将整个任务下发,下发前做的操作,就是将我的懒信息给左右孩子,计算左右孩子的信息,清空懒信息,</li> <li>看query.如果,我hold住了整个任务,那我直接告诉你结果即可.否则,你得问问我的孩子们了,问之前,下发我的懒信息.</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Code01_SegmentTree</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SegmentTree</span> <span class="token punctuation">{</span>
      <span class="token comment">// arr[]为原序列origin的信息改装,origin从0开始，但在arr里是从1开始的</span>
      <span class="token comment">// sum[]模拟线段树维护区间和</span>
      <span class="token comment">// lazy[]为累加和懒惰标记</span>
      <span class="token comment">// change[]为更新的值</span>
      <span class="token comment">// update[]为更新慵懒标记</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token constant">MAXN</span><span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sum<span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lazy<span class="token punctuation">;</span>

      <span class="token comment">//下面两个是Update时候才用到的</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> change<span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> update<span class="token punctuation">;</span>

      <span class="token keyword">public</span> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token constant">MAXN</span> <span class="token operator">=</span> origin<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token constant">MAXN</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// arr[0] 不用 从1开始使用</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">MAXN</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> origin<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token comment">//准备4倍,一定够用</span>
         sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token constant">MAXN</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用来支持脑补概念中，某一个范围的累加和信息</span>
         lazy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token constant">MAXN</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用来支持脑补概念中，某一个范围沒有往下传递的任务</span>

         <span class="token comment">//这两个是更新用的,增加时候,用不到!</span>
         change <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token constant">MAXN</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用来支持脑补概念中，某一个范围有没有更新操作的任务</span>
         update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token constant">MAXN</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用来支持脑补概念中，某一个范围更新任务，更新成了什么</span>
      <span class="token punctuation">}</span>

      <span class="token comment">//向上汇总</span>
      <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pushUp</span><span class="token punctuation">(</span><span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">//左移就是2*i.那么2*i+1就是左移后,右面的补0与上一个1,相当于+1.</span>
         sum<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 之前的，所有懒增加，和懒更新，从父范围，发给左右两个子范围</span>
      <span class="token comment">// 分发策略是什么</span>
      <span class="token comment">// ln表示左子树元素结点个数，rn表示右子树结点个数</span>
      <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pushDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> rt<span class="token punctuation">,</span> <span class="token keyword">int</span> ln<span class="token punctuation">,</span> <span class="token keyword">int</span> rn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">//更新时候用到</span>
         <span class="token comment">//如果来了这,更新和新增都有,为什么非要先更新,再新增,因为,两个都有,一定是先有更新,后有新增,因为更新直接就会清空懒信息.</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            update<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            update<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            change<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            change<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            lazy<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            lazy<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            sum<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">*</span> ln<span class="token punctuation">;</span>
            sum<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">*</span> rn<span class="token punctuation">;</span>
            update<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//懒方法.</span>
         <span class="token comment">//如果懒位置有值,需要先将懒任务下发给子级.只下发一层</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//左移就是*2的意思,将父级的懒信息加到我的左孩子,2*i位置</span>
            lazy<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//累加和直接乘法一次算出.</span>
            sum<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">*</span> ln<span class="token punctuation">;</span>
            <span class="token comment">//将父级的懒信息加到右孩子,2*i+1位置</span>
            lazy<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            sum<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">*</span> rn<span class="token punctuation">;</span>
            <span class="token comment">//我自己的懒信息清空.</span>
            lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 这个就是初始化,如何把原始数组,放到那个4N数组中,</span>
      <span class="token comment">//举个例子,数据范围是1~5,根据之前说的,1~5放在1位置,然后1~2放在2位置,3~5放在3位置,所以第一次调用这个build的时候,就是(1,5,1),里面递归分别是(1,2,2),(3,5,3)</span>
      <span class="token comment">//   (1,5,1)</span>
      <span class="token comment">//   /     \</span>
      <span class="token comment">//(1,2,2)  (3,5,3)</span>
      <span class="token comment">// 在arr[l~r]范围上，去build，1~N，</span>
      <span class="token comment">// rt : 这个范围在sum中的下标</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//l==r说明到了叶子节点了</span>
            sum<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token function">build</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">build</span><span class="token punctuation">(</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">pushUp</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      
      <span class="token comment">// L~R  所有的值变成C</span>
      <span class="token comment">// l~r  rt</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            update<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">;</span>
            sum<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">C</span> <span class="token operator">*</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">// 当前任务躲不掉，无法懒更新，要往下发</span>
         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token function">pushDown</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> mid <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">R</span> <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">pushUp</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// L~R, C 任务！总的那个</span>
      <span class="token comment">// rt，l~r 子的那个</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// 任务如果把此时的范围全包了！懒住,不下发了</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//计算所有数据加完了一个值后,累加和增加的值,一次算完,</span>
            sum<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token class-name">C</span> <span class="token operator">*</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//有个任务,需要懒住,将之前的和这次的一起懒住</span>
            lazy<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token class-name">C</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">// 任务没有把你全包！左右下发任务pushDown</span>
         <span class="token comment">// l  r  mid = (l+r)/2</span>
         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token comment">//两个参数是 左边有多少个,右边有多少个</span>
         <span class="token function">pushDown</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> mid <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//上面的pushDown!,相当于给老任务都结清了!我可以搞新任务了.</span>
         <span class="token comment">// L~R</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">R</span> <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//我等着我左边调对了,等着我右边调对了,我调整我自己的,pushUp</span>
         <span class="token function">pushUp</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 1~6 累加和是多少？ 1~8 rt</span>
      <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> sum<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token function">pushDown</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> mid <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">long</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ans <span class="token operator">+=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">R</span> <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ans <span class="token operator">+=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Right</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">;</span>

      <span class="token keyword">public</span> <span class="token class-name">Right</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>origin<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> origin<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> origin<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">L</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">L</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token class-name">C</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">long</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">L</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ans <span class="token operator">+=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">genarateRandomArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> len<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> origin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         origin<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> origin<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> testTimes <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> addOrUpdateTimes <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> queryTimes <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> testTimes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> origin <span class="token operator">=</span> <span class="token function">genarateRandomArray</span><span class="token punctuation">(</span>len<span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">SegmentTree</span> seg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> <span class="token class-name">S</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> origin<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
         <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
         seg<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Right</span> rig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Right</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> addOrUpdateTimes<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">N</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">N</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> <span class="token class-name">L</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> <span class="token class-name">R</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> <span class="token class-name">C</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               seg<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
               rig<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               seg<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
               rig<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> queryTimes<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">N</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">N</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> <span class="token class-name">L</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> <span class="token class-name">R</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> ans1 <span class="token operator">=</span> seg<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> ans2 <span class="token operator">=</span> rig<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ans1 <span class="token operator">!=</span> ans2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> origin <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">SegmentTree</span> seg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> <span class="token class-name">S</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 整个区间的开始位置，规定从1开始，不从0开始 -&gt; 固定</span>
      <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> origin<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 整个区间的结束位置，规定能到N，不是N-1 -&gt; 固定</span>
      <span class="token keyword">int</span> root <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 整棵树的头节点位置，规定是1，不是0 -&gt; 固定</span>
      <span class="token keyword">int</span> <span class="token class-name">L</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 操作区间的开始位置 -&gt; 可变</span>
      <span class="token keyword">int</span> <span class="token class-name">R</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 操作区间的结束位置 -&gt; 可变</span>
      <span class="token keyword">int</span> <span class="token class-name">C</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 要加的数字或者要更新的数字 -&gt; 可变</span>
      <span class="token comment">// 区间生成，必须在[S,N]整个范围上build</span>
      seg<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 区间修改，可以改变L、R和C的值，其他值不可改变</span>
      seg<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 区间更新，可以改变L、R和C的值，其他值不可改变</span>
      seg<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 区间查询，可以改变L和R的值，其他值不可改变</span>
      <span class="token keyword">long</span> sum <span class="token operator">=</span> seg<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;对数器测试开始...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;测试结果 : &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;通过&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;未通过&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="落方块问题"><a href="#落方块问题" class="header-anchor">#</a> 落方块问题</h2> <blockquote><p>想象一下标准的俄罗斯方块游戏，X轴是积木最终下落到底的轴线<br>
下面是这个游戏的简化版：<br>
1）只会下落正方形积木<br>
2）[a,b] -&gt; 代表一个边长为b的正方形积木，积木左边缘沿着X = a这条线从上方掉落<br>
3）认为整个X轴都可能接住积木，也就是说简化版游戏是没有整体的左右边界的<br>
4）没有整体的左右边界，所以简化版游戏不会消除积木，因为不会有哪一层被填满。</p> <p>给定一个N*2的二维数组matrix，可以代表N个积木依次掉落，<br>
返回每一次掉落之后的最大高度</p></blockquote> <p>就是下面这样,先来个[1,3],再来个[3,2],只要卡住一点点,就会落在上面,而不会掉下来.没有重心问题.</p> <p><img src="/assets/img/image-20240624232154152.0a0d5d39.png" alt="image-20240624232154152"></p> <p>这个问题核心思想就是,我在某个范围来了一个方块的时候,我先看看他的最大高度,然后累加我的高低,然后我这个范围的最大高度都统一更新.例如上图,[3,2]来了,他需要先知道3~5范围最大高度是多少,先调用一个线段树query,是3,然后我的高度是2,所以,我给3~5全部更新为5,这时候如果来的是10开始,毫不相干,就是高度+0,如果此刻来的是4,2,那我们发现4这个区间高度已经是5了,所以还要+2,然后给4~6范围都改为7.循环往复.每次一个方块落下来,我都能记录一个当前最高的高度.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Code02_FallingSquares</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SegmentTree</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> max<span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> change<span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> update<span class="token punctuation">;</span>

      <span class="token keyword">public</span> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         max <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token class-name">N</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

         change <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token class-name">N</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token class-name">N</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pushUp</span><span class="token punctuation">(</span><span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         max<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// ln表示左子树元素结点个数，rn表示右子树结点个数</span>
      <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pushDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> rt<span class="token punctuation">,</span> <span class="token keyword">int</span> ln<span class="token punctuation">,</span> <span class="token keyword">int</span> rn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            update<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            update<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            change<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            change<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            max<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            max<span class="token punctuation">[</span>rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
            update<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">C</span><span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            update<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            change<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">;</span>
            max<span class="token punctuation">[</span>rt<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">C</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token function">pushDown</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> mid <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">R</span> <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token function">pushUp</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> rt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> l <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;=</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> max<span class="token punctuation">[</span>rt<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token function">pushDown</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> mid <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span> <span class="token operator">&lt;=</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            left <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> l<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">R</span> <span class="token operator">&gt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            right <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> rt <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> positions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> pos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">:</span> positions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         pos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         pos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> index <span class="token operator">:</span> pos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> map<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallingSquares</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> positions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">SegmentTree</span> segmentTree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SegmentTree</span><span class="token punctuation">(</span><span class="token class-name">N</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 每落一个正方形，收集一下，所有东西组成的图像，最高高度是什么</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">:</span> positions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">int</span> <span class="token class-name">L</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> <span class="token class-name">R</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> height <span class="token operator">=</span> segmentTree<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         max <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
         res<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
         segmentTree<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">L</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="刷房子问题"><a href="#刷房子问题" class="header-anchor">#</a> 刷房子问题.</h2> <blockquote><p>我有一排民居,编号1~N,我有56种颜色.我每次可以给[L,R]刷一个颜色,求任何时刻,我L~R范围,有多少种颜色.</p></blockquote> <p>线段树可以解决</p> <p>我一共56种颜色,我用一个long型来记录,000...1为有第一种颜色, 000....10为有第二种颜色,000....11为第一种,第二种都有,所以,56个bit可以记录下来所有的颜色.</p> <p>我让每个左右孩子都记录一个long值,代表他们的范围内有多少个颜色,叶子节点肯定就是只有1个颜色.只有1个1.</p> <p>向上pushUp的时候,左右孩子怎么汇总,用|,例如4位简化,0101代表左侧第1,3种颜色,右侧0010代表右侧有第2种,我就有0101|0010=0111,我有三种颜色.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/算法体系/31-Morris遍历.html" class="prev">
        Morris遍历
      </a></span> <span class="next"><a href="/算法体系/大厂-21-树链刨分.html">
        树链刨分
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e07e71c0.js" defer></script><script src="/assets/js/2.141f6c6e.js" defer></script><script src="/assets/js/1.aeca74fc.js" defer></script><script src="/assets/js/37.7c920bbb.js" defer></script>
  </body>
</html>
