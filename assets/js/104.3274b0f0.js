(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{690:function(t,a,s){"use strict";s.r(a);var n=s(17),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql-突击班-第四天"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-突击班-第四天"}},[t._v("#")]),t._v(" MySQL-突击班（第四天）")]),t._v(" "),a("h2",{attrs:{id:"一、mvcc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、mvcc"}},[t._v("#")]),t._v(" 一、MVCC")]),t._v(" "),a("h3",{attrs:{id:"_1-1-mvcc是个啥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-mvcc是个啥"}},[t._v("#")]),t._v(" 1.1 MVCC是个啥？")]),t._v(" "),a("blockquote",[a("p",[t._v("MVCC（Multi Version Concurrency Control），多版本并发控制。")]),t._v(" "),a("p",[t._v("他就是一种提升并发能力的技术。 最早的时候操作，基本只有读读是可以并发执行的。只要涉及到了写操作，那就必须要阻塞。")]),t._v(" "),a("p",[t._v("但是引入了MVCC之后，咱们可以做到读写，写读的并发。但是写写依然是互斥的。")]),t._v(" "),a("p",[t._v("在MVCC内部，是基于InnoDB通过undo log保存的数据记录的版本信息来实现的。每个事务读到的数据版本可能会不一样。在同一个事务中，用户只能看到当前事务创建快照前就已经提供了的数据，以及事务本身操作的数据。")]),t._v(" "),a("p",[t._v("MVCC在 Read Committed以及Repeatable Read中才会使用到。")]),t._v(" "),a("p",[t._v("MVCC的实现是基于三点来玩的："),a("strong",[t._v("隐藏字段、undo log、Read View")]),t._v(" 这三者配合实现的。")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-隐藏字段是个啥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-隐藏字段是个啥"}},[t._v("#")]),t._v(" 1.2 隐藏字段是个啥？")]),t._v(" "),a("blockquote",[a("p",[t._v("InnoDB向数据库中存储的每一行添加了三个字段：")]),t._v(" "),a("p",[a("strong",[t._v("DB_TRX_ID：")]),t._v(" 标识最近一次对当前行数据做修改（Insert，Update）的事务ID。至于delete操作，属于Update。事务ID是递增的~~")]),t._v(" "),a("p",[a("strong",[t._v("DB_ROLL_PTR：")]),t._v(" 回滚指针，undo log中记录的多个版本之间，使用DB_ROLL_PTR来连接上。")]),t._v(" "),a("p",[a("strong",[t._v("DB_ROW_ID：")]),t._v(" 如果表里没有主键，没有非空唯一索引，那么这个隐藏字段会作为聚簇索引存在。这玩应和MVCC关系不大，了解即可。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/1249046e06a64eeda6eb3032689e9044.png",alt:"image.png"}})])]),t._v(" "),a("h3",{attrs:{id:"_1-3-undo-log存储的数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-undo-log存储的数据结构"}},[t._v("#")]),t._v(" 1.3 undo log存储的数据结构")]),t._v(" "),a("blockquote",[a("p",[t._v("比如现在有一张user表，里面有id，name两个字段。现在数据存在一条，id = 1，name = 张三")]),t._v(" "),a("p",[t._v("如果，现在长这样")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/bd104e105a0c46bca7054dc2cde77b74.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("现在有一个事务ID为2，要修改这个数据，将name修改为李四")]),t._v(" "),a("ul",[a("li",[t._v("获取互斥锁")]),t._v(" "),a("li",[t._v("需要先将当前数据行复制到undo log中，作为旧版本。")]),t._v(" "),a("li",[t._v("复制完毕后，将张三修改为李四，并且将DB_TRX_ID修改为2，并且将回滚指针指向undo log里的旧版本")]),t._v(" "),a("li",[t._v("提交事务后，释放锁。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/dce1f2bb5a234847accfe7c723a38d82.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("现在又来了一个事务ID为3，修改这行数据，将李四修改为王五")]),t._v(" "),a("ul",[a("li",[t._v("获取互斥锁")]),t._v(" "),a("li",[t._v("需要先将当前数据行复制到undo log中，作为旧版本。")]),t._v(" "),a("li",[t._v("复制完毕后，将李四修改为王五，并且将DB_TRX_ID修改为3，并且将回滚指针指向undo log里的旧版本")]),t._v(" "),a("li",[t._v("提交事务，释放锁")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/20629e0aeb9f48ae9b6ebbe62fa75061.png",alt:"image.png"}})])]),t._v(" "),a("h3",{attrs:{id:"_1-4-read-view内部结构存储了个啥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-read-view内部结构存储了个啥"}},[t._v("#")]),t._v(" 1.4 Read View内部结构存储了个啥？")]),t._v(" "),a("blockquote",[a("p",[t._v("Read View其实和快照是一个意思。")]),t._v(" "),a("p",[t._v("Read View是读操作中的可见性判断的核心，也就是当前事务能不能读取undo log中的某行数据以及当前行数据。Read View内部还维护的很多的属性以及逻辑。")]),t._v(" "),a("p",[t._v("在开启事务后， "),a("strong",[t._v("执行第一个select操作后")]),t._v(" ，会创建一个Read View，也就是快照。")]),t._v(" "),a("p",[t._v("在Read View中会保存不应该被当前事务看到的，其他 "),a("strong",[t._v("活跃事务的列表")]),t._v(" 。")]),t._v(" "),a("p",[t._v("当用户在这个事务中要读取某行记录时，InnoDB会将该行的 "),a("strong",[t._v("DB_TRX_ID")]),t._v(" 和 "),a("strong",[t._v("Read View")]),t._v(" 中的一些变量去做比较，判断当前数据能否查看到。")]),t._v(" "),a("p",[t._v("要查看一下Read View 里面的存储结构信息。")]),t._v(" "),a("p",[t._v("https://github.com/facebook/mysql-8.0/blob/8.0/storage/innobase/include/read0types.h")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/42b79df13cf84da8a2901952637d38d0.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("这四个属性中，分别聊一下：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("m_creator_trx_id：")]),t._v(" 当前事务的TRX_ID，也就是事务ID\n"),a("ul",[a("li",[t._v("人话：当前事务的ID，当前事务要创建这个Read View快照。")])])]),t._v(" "),a("li",[a("strong",[t._v("m_ids：")]),t._v(" 创建快照时，处于活跃事务的ID集合。\n"),a("ul",[a("li",[t._v("人话：未提交事务的事务的集合。因为事务没提交，所以这里的数据是不可见的。并且活跃事务列表不会记录当前事务。")])])]),t._v(" "),a("li",[a("strong",[t._v("m_low_limit_id：")]),t._v(" 读取时不应看到任何trx id>=此值的事务。换句话说，这是“高水位线”\n"),a("ul",[a("li",[t._v("人话：当前行数据的事务ID，大于等于m_low_limit_id，数据是不可见的。说白了，当前事务在创建Read View快照时，这个事务他还没开始呢，他的数据必然是不可见的。通过查看m_low_limit_id的赋值，"),a("strong",[t._v("可以得知他是还未被分配的事务的最小事务ID")]),t._v(" ，"),a("strong",[t._v("其实就是最大活跃事务 + 1。")])])])]),t._v(" "),a("li",[a("strong",[t._v("m_up_limit_id：")]),t._v(" 读取应该看到所有严格小于（<）此值的trx id。换句话说，这是低水位线”\n"),a("ul",[a("li",[t._v("人话： "),a("strong",[t._v("他是活跃事务列表中的最小事务ID")]),t._v(" ，比这个事务ID还要小的值，他事务必然已经提交了，所以如果当前行数据的事务ID 小于 m_up_limit_id，我是可见的。如果活跃事务列表为空，m_up_limit_id = m_low_limit_id。")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/d5acb2bee9c4408f93f315b84d6a8ac2.png",alt:"image.png"}})]),t._v(" "),a("p",[a("strong",[t._v("在RC的隔离级别下，每次执行select操作时，都会创建一个全新的Read View。")])]),t._v(" "),a("p",[a("strong",[t._v("在RR的隔离级别下，只有第一次select操作时，会创建Read View，后续再查询，都基于第一次的Read View做可见性判断。")])])]),t._v(" "),a("h3",{attrs:{id:"_1-5-readview可见性判断的逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-readview可见性判断的逻辑"}},[t._v("#")]),t._v(" 1.5 ReadView可见性判断的逻辑")]),t._v(" "),a("blockquote",[a("p",[t._v("在源码中，可以看到可见性判断的逻辑")]),t._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// id参数，是你想查看的那行数据的事务ID")]),t._v("\nbool "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("changes_visible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("trx_id_t")]),t._v("\t\tid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("table_name_t")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\tname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("MY_ATTRIBUTE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("warn_unused_result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ut_ad")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// m_up_limit_id 是活跃事务的最小id，如果当前行的事务ID，小于m_up_limit_id，说明这个事务必然已经提交了，这个数据是可见的。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果当前行的事务ID和当前创建ReadView的事务ID相等，说明就是当前事务修改的数据，必然可见。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" m_up_limit_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" m_creator_trx_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("check_trx_id_sanity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前行的事务ID，大于了m_low_limit_id，必然不可见。创建Read View的时候，m_low_limit_id这个事务还没有呢。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" m_low_limit_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 没有活跃事务，并且当前行数据的事务ID，还小于m_low_limit_id，那这个数据必然可见。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m_ids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("empty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ids_t")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("value_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\tp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" m_ids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果上述情况都不满足，无法判断可见还是不可见，此时需要拿着当前行的事务ID，以及活跃事务列表开始判断。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1、如果我发现当前行的事务ID，在活跃事务列表中。此时在Read View来说，这个事务没提交，不可见。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2、如果我发现当前行的事务ID，不在活跃事务列表中，说明创建Read View时候，你就提交了，可见。")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("std"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("binary_search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" m_ids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("各种例子：")]),t._v(" "),a("p",[t._v("1、id < up_limit_id，直接可见。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/b156c0e8c6d8433dac08f890153161a6.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("2、RC隔离级别下，第二次查询会重新创建Read View，可以读取到刚刚提交事务的数据")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/710e3caeca904353a89793694837677c.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("3、RR隔离级别下，第二次查询不会重新构建Read View，新数据不可见。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/11fbb1ca19bf4cea959708b2e9b7fd12.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("4、当前行事务ID不在活跃事务列表中。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/d1c13e1783a444dca55766c9d1584b03.png",alt:"image.png"}})])]),t._v(" "),a("hr"),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("事务A")]),t._v(" "),a("th",[t._v("事务B")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("查询数据")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td"),t._v(" "),a("td",[t._v("修改了这个数据，并且提交事务")])]),t._v(" "),a("tr",[a("td",[t._v("再次查询数据")]),t._v(" "),a("td")])])]),t._v(" "),a("p",[t._v("事务A，能传到事务B提交的数据么？")]),t._v(" "),a("p",[t._v("面试被问到的话，先问是RC还是RR的隔离级别。~~~")]),t._v(" "),a("h2",{attrs:{id:"二、mysql主从同步的原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、mysql主从同步的原理"}},[t._v("#")]),t._v(" 二、MySQL主从同步的原理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/8bbfef2fdfc44e96a18542c8035619ff.png",alt:"image.png"}})]),t._v(" "),a("blockquote",[a("p",[t._v("MySQL的主从同步的过程中，要从几个维度聊。")]),t._v(" "),a("ul",[a("li",[t._v("你的Master在做写操作时，会将写操作记录到bin log中。")]),t._v(" "),a("li",[t._v("你的Slave从库会监听Master节点中的bin log的变化，如果有变化。\n"),a("ul",[a("li",[t._v("Slave需要主动的找Master节点要bin log中的数据，发起请求")]),t._v(" "),a("li",[t._v("Master会将bin log的内容发送给Slave。")])])]),t._v(" "),a("li",[t._v("Slave接收到bin log信息后，不会立即同步，会扔到relay log中缓冲一下。")]),t._v(" "),a("li",[t._v("Slave再从Relay log中将数据同步到Slave中。")])])]),t._v(" "),a("h2",{attrs:{id:"三、mysql主从同步必然有延迟-怎么办"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、mysql主从同步必然有延迟-怎么办"}},[t._v("#")]),t._v(" 三、MySQL主从同步必然有延迟，怎么办？")]),t._v(" "),a("p",[t._v("只能尽量的减少延迟，想解决的话，同步的成本很高。")]),t._v(" "),a("p",[t._v("如果必须要数据强一致，那就不能用主从的效果，自己搞一个众生平等的套路。")]),t._v(" "),a("p",[t._v("让写数据的时，同步写到多个MySQL节点中，都成功才成功！但是这样，写操作的效率必然大打折扣！（基本没有这么干的）")]),t._v(" "),a("p",[t._v("但是一般情况下，大多是尽可能的提升主从同步的效率。。。")]),t._v(" "),a("ul",[a("li",[t._v("优化查询等其他操作，让出服务器资源，避免影响同步时的资源被占用…………")]),t._v(" "),a("li",[t._v("规避大事务，别一次同步大量数据，这个成本也高…………")]),t._v(" "),a("li",[t._v("MySQL从库同步时，可以指定多线程同步，提升效率：https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html#sysvar_replica_parallel_workers    （搜workers）")]),t._v(" "),a("li",[t._v("bin log同步可以指定具体的库，减少不必要的同步操作。https://dev.mysql.com/doc/refman/8.0/en/replication-options-replica.html#--replicate-do-db      （搜do-db）")]),t._v(" "),a("li",[t._v("服务器的资源给力点，网络的带宽大一点，磁盘必然上固态，多多监控一下，如果有延迟时间长的点，排查一下………………")]),t._v(" "),a("li",[t._v("半同步复制的套路………………")])]),t._v(" "),a("h2",{attrs:{id:"n、bin-log、undo-log存哪了-了解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n、bin-log、undo-log存哪了-了解"}},[t._v("#")]),t._v(" N、bin log、undo log存哪了？（了解）")]),t._v(" "),a("blockquote",[a("p",[t._v("bin log、undo log存哪了？")]),t._v(" "),a("p",[t._v("存到磁盘是必然的。")]),t._v(" "),a("p",[t._v("其次，bin log是你指定存在哪个位置，他就存在哪个位置。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/2746/1725795434018/3c8ebe5118d4413ba1daf6f7b33ea468.png",alt:"image.png"}}),t._v("undo log根据版本不同，存放的位置也各不一样。")]),t._v(" "),a("p",[t._v("在8.0之后，会有一个单独的undo log的目录，来存放undo log文件。")]),t._v(" "),a("p",[t._v("之前的版本也会存放到ibdata1文件中…………")])])])}),[],!1,null,null,null);a.default=e.exports}}]);